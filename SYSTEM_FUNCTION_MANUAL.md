# Channel HF 系统功能说明书

本文档详细说明了 Channel HF 系统近期新增的三大核心功能：批量参数测试、详细拒绝分析及标准化参数说明。

## 1. 批量参数测试工具 (Batch Parameter Test)

### 1.1 功能概述
批量参数测试工具旨在解决手动测试效率低下的问题，允许用户一次性对多只股票、多个参数组合进行并行测试，并自动汇总对比结果。

### 1.2 界面入口
在系统顶部导航栏选择 **"批量测试" (Batch Test)** 标签页（如未显示，请确认已更新至最新版本）。

### 1.3 使用说明

#### A. 股票代码输入
在“股票代码”输入框中，输入需要测试的股票代码。
- 支持格式：`000001.SZ, 600519.SH`
- 分隔符：支持逗号、空格或换行符
- 建议：初次测试建议少量股票（3-5只）以验证配置。

#### B. 参数组合配置 (支持两种模式)

**模式一：网格参数生成（推荐）**
在左侧“参数网格配置”区域输入参数范围，系统将自动生成所有可能的组合（笛卡尔积）。
- **格式**：`参数名: [值1, 值2, 值3]`
- **示例**：
  ```
  vol_shrink_min: [1.0, 1.05]
  vol_shrink_max: [1.1, 1.15]
  min_channel_height: [0.04, 0.05]
  ```
- **操作**：输入后点击 **"生成组合 ->"** 按钮，生成的组合将显示在右侧文本框中。

**模式二：手动输入**
直接在右侧“参数组合列表”文本框中输入或修改特定组合。
- **格式**：`key1=val1, key2=val2` (每行一个组合)
- **示例**：
  ```
  vol_shrink_min=1.0, vol_shrink_max=1.1
  vol_shrink_min=1.05, vol_shrink_max=1.15
  ```

#### C. 执行与结果
1. 点击 **"开始批量测试"** 按钮。
2. 系统将并行运行测试任务，实时显示进度。
3. **结果表格**：测试完成后，下方表格将显示每个组合的绩效指标：
   - **交易数** (Trades)
   - **胜率** (Win Rate)
   - **总收益** (Total Return)
   - **最大回撤** (Max Drawdown)
4. **导出**：点击表格右上角的 **"导出 Excel"** 按钮，可将所有结果保存为 CSV 文件用于深度分析。

---

## 2. 详细拒绝分析 (Detailed Rejection Analysis)

### 2.1 功能概述
在回测或扫描过程中，当一只股票未产生交易信号时，系统能够提供详细的“拒绝原因”分析，帮助用户理解策略过滤的具体环节。

### 2.2 如何查看
1. 运行 **回测 (Backtest)** 任务。
2. 在结果表格中，对于没有交易的股票（或感兴趣的股票），点击行末的 **"查看详情" (View Details)** 按钮（或相关链接）。
3. 系统将弹出 **"拒绝详情分析"** 面板。

### 2.3 面板内容解读
面板以表格形式列出了该股票在每一天被拒绝的具体原因：
- **日期 (Date)**: 发生拒绝的交易日。
- **过滤器类型 (Filter Type)**: 拒绝发生的策略阶段（如：量能过滤、通道过滤、趋势过滤等）。
- **检查条件 (Condition)**: 具体执行的判断逻辑（如：`vol_ratio >= min`）。
- **实际值 (Actual)**: 当日计算出的指标数值（如：`0.95`）。
- **阈值要求 (Threshold)**: 策略设定的标准（如：`>= 1.0`）。
- **拒绝原因 (Reason)**: 系统生成的易读描述（如：`低于下限: 1.0`）。

### 2.4 数据导出
在详情面板底部，点击 **"导出 CSV"** 按钮，可将该股票的所有拒绝记录导出，便于进行统计分析（例如：分析哪一类过滤条件过于严格）。

---

## 3. 参数说明清晰化 (Parameter Definitions)

### 3.1 功能概述
为了解决参数含义模糊的问题，系统全面重构了参数说明体系，提供标准化的定义、逻辑解释和优化建议。

### 3.2 查看方式
1. **鼠标悬停 (Hover)**: 在 **"配置" (Config)** 界面，将鼠标悬停在任意参数标签上，会显示简短的工具提示。
2. **详细说明面板**: 点击配置界面顶部的 **"详细说明"** 按钮，弹出完整帮助文档。

### 3.3 标准化格式
每个参数均包含以下信息：
- **名称**: 中文名称及代码变量名 (e.g., 量能下限 / `vol_shrink_min`)
- **类型**: 数值、布尔值或选项
- **默认值 & 范围**: 系统推荐的默认设置及合理调整区间
- **单位**: 如百分比、天数、比率等
- **说明**: 参数的核心作用及判断逻辑（包含公式）
- **示例**: 具体数值及其代表的含义
- **优化建议**: 调大或调小该参数对策略结果的预期影响（如：“调高 min 会导致买入更谨慎，但可能错过机会”）。

### 3.4 关键参数速查
- **vol_shrink_min / max**: 控制成交量缩量比例。`1.0` 代表与均量持平，`<1.0` 代表缩量。
- **min_channel_height**: 通道最小高度（百分比），用于过滤波动过小的“死鱼”股。
- **close_in_channel_min / max**: 收盘价在通道内的相对位置（0=下轨，1=上轨），用于控制抄底深度。

---

## 4. 附录：常见问题

**Q: 批量测试时浏览器卡顿怎么办？**
A: 批量测试在后台并行运行，但大量数据渲染可能影响前端。建议一次测试不超过 50 个组合。如果需要大规模测试，建议分批进行。

**Q: 为什么有些拒绝记录没有“实际值”？**
A: 某些布尔类型过滤（如“是否停牌”）可能没有具体的数值对比，此时实际值可能显示为 `-` 或状态描述。

**Q: 导出的 CSV 打开是乱码？**
A: 系统默认使用 UTF-8 编码。如果在 Excel 中打开乱码，请尝试使用“数据 -> 导入文本”功能，并选择 UTF-8 编码格式。
